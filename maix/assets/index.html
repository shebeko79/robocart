<!DOCTYPE html>
<html>
<head>
    <title>Robot</title>
    <style>
        .button-container {
            margin-top: 20px;
        }
        .button-container button {
            margin: 5px;
        }
        .button-container button:disabled {
            background-color: lightgray;
            color: gray;
        }
    </style>
</head>
<script>
function reloadImg() {
    var timestamp = new Date().getTime();
    var image = document.getElementById("cam_img");
    image.src = "/img?t=" + timestamp;
}

function fetchState() {
    fetch('/state')
        .then(response => response.json())
        .then(data => {
            updateButtons(data.buttons);
        })
        .catch(error => console.error('Error fetching state:', error));
}

function updateButtons(buttons) {
    var buttonContainer = document.getElementById("button-container");
    buttonContainer.innerHTML = ''; // Clear existing buttons

    buttons.forEach(button => {
        var btn = document.createElement("button");
        btn.innerText = button.caption;

        if (button.enabled) {
            btn.onclick = function() {
                alert(button.caption + ' button clicked!');
                // Add more functionality here if needed
            };
        } else {
            btn.disabled = true; // Disable the button
        }

        buttonContainer.appendChild(btn);
    });
}

document.addEventListener("DOMContentLoaded", function() {
    fetchState(); // Fetch initial state
    setInterval(fetchState, 1000); // Fetch state every 5 seconds
});
</script>
<body>
    <img id="cam_img" src="/img" width="640" height="480" onload="setTimeout(reloadImg, 1000)"/>
    <div id="button-container" class="button-container"></div>
</body>
</html>
